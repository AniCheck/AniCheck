import log from 'fancy-log'
import jwt, { JwtPayload } from 'jsonwebtoken'

const PRIVATE_KEY = Buffer.from('LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBaTdVYUpHSlF4VEF0Ty9yV2xENWlNYjNDdWxPbThoMzdBSksyazl4K3ZVZm8wTExaClRyU1ZhdXRINGE0TjJOelZNckdrQStEQ0U3OFVMTmJlNDVuQ2lrcURnWFBaUlRRYVBMUlVwVEUza0dNT2lHOEIKTW5rTG9vVDY3UUQ0WkhKKzZERW9mQ3Y5aHZEVmhWZmluRGhNZ2kyUHk4ZlVQaFdGVVBNZjdrNGs4a3BNN0FaNApBUmxkTk45d2dzeWJhZTJQaW8weTZ4SzBaYll3c0Q5eHpKSVB1dEZPWFE2K2RiUHlLT3hUdmJjTFVyZzVjU0R6Ck1INWdDMEt4bmcyZ1hhMTFnWW5McTBWOUY5UUcvVXFsVlFIL2tJemxad3dPU3U2OGF3SzdGdGI4Q2Q2cjBWTDUKd0VoZEpGVzdEVjlWNGFrTUJlTWxEUjZqS3NhSE54VFB2eGxsblFJREFRQUJBb0lCQUVOZDl0Y29tVzRjaHhOdgpKMTJnbjFVQS9nOC9HemVSQVdJTFhRTDd4aG1idlVZMWw5ZjkrRGJ3Y1Y3L3dTbWJneXJJd2lBa2x6RlNhSFllCnZxZmRreE9BVHQxemNZZVBVaitIYlhHaXcvcFo2YjRjV09WdnZRNkhOVUJud1Y4ZVh0ZTBMS09EeXVMdzZ1VTcKdGNoQzFaSElTcGluS1U4dXJYU1ZhQVpQcEQwNHBCN3VjWHNrc3N4TSs2enVvdU1OeFZTeVVtN29HUHAvdjZURgp5UUIxNHRhN2x3M0Y1ZTR4dStLZ3dDZ1FobjJHazkvc0tGdXJlbS9lUWY4Y0VWNGliMi9LampscU81eW9aTkErCjZXdW1DSm9hV0E3bGI1VU1tUHVwNE9SNmR2Y09tdnJDblNUdUVZOXFlYUd4M2o1QjZxOTJ4akpNM1ovOEp5NlIKVEU4b052a0NnWUVBeUpZVUwrb3F5V0ZleVlQTmRUeHdFeXo1VnRja0xzNG95VU1ZczBzcTNGb2hVc3p4OWsvVQpFaFJnTVA4emQ4Q1Rhc0RHTm5Bem5HcXQ3eUJ2dDE0c2ZkZ280ZHJNaFMydTgrL2pNbDJzZkhINGhRZW9obG5sCjhPaUlGeHljd2thQlQ1VXhJZlEyd2poUWRpWVRLdWFkY3dxd2RQaWRkQk0vZ0hJLzRTZVNjUWNDZ1lFQXNrMkkKZzh1a1lBRnpxSzZGY2VQTTV3aFAxaXVwb2t2V09vY2NYRjczdlhFZzVJZVJCN0NEZGhaS3dad01QM1BHQkdpMgpDL1l5SHUyVXl4RUFYT0xEanlDdnYrOEdYZWwvS0xtTUhhVDhkM2d1dGZCZExSaUVGcEd6bFpadWJuQW9RRitaCndFYTRkZU8xZkFVSUJsMDl5RDc5VG4xZVRYN0lETUh4cXBjcW56c0NnWUFyZmU4T25KVithTEJtdlQ5VlJpOSsKMk9lUFhzS25xMmZJaTlYVk9sMG12aHd2bWVSMDVjWXp6VnMyQkgraVhZMFpQb2M3MG9RK1RCcyttQ2ZnK0hocApLTzlrV1U2ektiNmZnY29mWjVRNHYzV0ZVcTNGdzhSSndnR1FFVklrQmFtUUdlYzNWMzV3Q2tuWDlGVi9uZFZSCjFtV0FWMCs4bFZmVmYvQTkzNWl2RFFLQmdGWWxmNyt0dEUxdVppTXBydS9IMEVnUGpBTStOVWRrdkt5cWV0bG0KU093T3JJVzl1aVNzODljcURoUmRBTTNuY2RUUGdxVmszZkp6ZDJCbFpuZDZXR0hldVF0U3dSQytyK0ZOUkpWTwpFV3puZENvVFovRlIxdi9RaGFQUWVxcUJKZkYwUHlUWEJtaHZERkJQWGdFMUs1U0VXbjZCcy81ZE11cDNDZndSCjdWWGhBb0dCQU1lV0V6UFFmS2VZcEt3S1Rqb1NEMS9tbkxmNklPQ3htWkFFdDlUcUsreWxWRGs5eFZkV1RzNXIKajZ2L3RzcXZNQzFHOWRqd1ZxZjZuOEFSVmVXUlhPMmQ3UUFqa09NTWwvcTZZTFRPakMwbjBLTlBUQmVXSTUwOQpselBPRDJPcm80bkY3bFVkcENUYmFXOHpiZzQwdXM3V0dzUzRYb0hNNHRZR1RtK1c2VjNtCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t', "base64").toString('ascii');
const PUBLIC_KEY = Buffer.from("LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFpN1VhSkdKUXhUQXRPL3JXbEQ1aQpNYjNDdWxPbThoMzdBSksyazl4K3ZVZm8wTExaVHJTVmF1dEg0YTROMk56Vk1yR2tBK0RDRTc4VUxOYmU0NW5DCmlrcURnWFBaUlRRYVBMUlVwVEUza0dNT2lHOEJNbmtMb29UNjdRRDRaSEorNkRFb2ZDdjlodkRWaFZmaW5EaE0KZ2kyUHk4ZlVQaFdGVVBNZjdrNGs4a3BNN0FaNEFSbGROTjl3Z3N5YmFlMlBpbzB5NnhLMFpiWXdzRDl4ekpJUAp1dEZPWFE2K2RiUHlLT3hUdmJjTFVyZzVjU0R6TUg1Z0MwS3huZzJnWGExMWdZbkxxMFY5RjlRRy9VcWxWUUgvCmtJemxad3dPU3U2OGF3SzdGdGI4Q2Q2cjBWTDV3RWhkSkZXN0RWOVY0YWtNQmVNbERSNmpLc2FITnhUUHZ4bGwKblFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0t", "base64").toString('ascii');

export function signJwt(object: Object, options?: jwt.SignOptions | undefined) {
    return jwt.sign({ data: object }, PRIVATE_KEY, {
        ...(options && options),
        algorithm: "RS256"
    })
}

export function verifyJwt<T>(token: string): T | null {
    try {
        const decoded = jwt.verify(token, PUBLIC_KEY) as JwtPayload
        return decoded.data as T
    } catch (e) {
        return null
    }
}